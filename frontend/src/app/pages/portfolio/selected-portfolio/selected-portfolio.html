@if (portfolioItem(); as item) {
  <app-jumbotron [imageAlt]="'Abstract background for ' + item.title_portfolio">
    <div jumbotron-main>
      <h1 class="display-6 display-md-5 fw-bold">{{ item.title_portfolio }}</h1>
      <p class="fs-5 fs-md-4">{{ item.category_portfolio }} - {{ item.subcategory_portfolio }}</p>
    </div>
  </app-jumbotron>

  <div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center mb-4">
    <a routerLink="/portfolio" class="btn btn-outline-secondary d-inline-flex align-items-center">
      <svg class="bi me-2" width="16" height="16" aria-hidden="true"><use xlink:href="#arrow-left"></use></svg>
      Back to Portfolio
    </a>
    <div class="btn-group mt-2 mt-sm-0" role="group" aria-label="Project navigation">
      @if (previousItem(); as prev) {
        <a [routerLink]="['/portfolio', prev.id_portfolio]" class="btn btn-outline-secondary d-inline-flex align-items-center">‹<span class="d-none d-sm-inline ms-1">Previous</span></a>
      }
      @if (nextItem(); as next) {
        <a [routerLink]="['/portfolio', next.id_portfolio]" class="btn btn-outline-secondary">Next ›</a>
      }
    </div>
  </div>
  <div class="row">
    <!--  -->
    <article class="col-md-8">
      <figure class="mb-3 rounded main-portfolio-figure">
        <img [src]="item.image_portfolio" class="img-fluid img-widescreen-crop" [alt]="item.title_portfolio" [appImageFallback]="'assets/images/placeholder/placeholder-image.png'" />
      </figure>

      <!-- Image Gallery -->
      @if ((item.gallery_portfolio?.length ?? 0) > 0) {
        <app-image-gallery [images]="item.gallery_portfolio ?? []" [title]="item.title_portfolio" [modalId]="'portfolioCarouselModal'" />
      }

      <section>
        <h2 class="lh-1">Deskripsi Proyek</h2>
        <p class="lead">{{ item.desc_portfolio }}</p>
      </section>

      <!-- Related Blog Posts Section -->
      @if (relatedBlogs().length > 0) {
        <section>
          <div class="mt-5">
            <h2 class="pb-2 border-bottom">Artikel Terkait</h2>
            <div class="list-group">
              @for (blog of relatedBlogs(); track blog.id_blog) {
                <a [routerLink]="['/blog', blog.id_blog]" class="list-group-item list-group-item-action d-flex gap-3 py-3" aria-current="true">
                  <svg class="bi flex-shrink-0" width="24" height="24"><use xlink:href="#journal-text"></use></svg>
                  <div class="d-flex gap-2 w-100 justify-content-between align-items-center">
                    <h6 class="mb-0">{{ blog.title_blog }}</h6>
                  </div>
                </a>
              }
            </div>
          </div>
        </section>
      }


    </article>
    <!--  -->
    <aside class="col-md-4 mt-4 mt-md-0">
      <div class="position-sticky" style="top: calc(var(--header-height, 120px) + 2rem);">
        <div class="card">
          <div class="card-body pb-0">
            <h5 class="card-title">Detail Proyek</h5>
            <dl class="row">
              <dt class="col-sm-4">Kategori</dt>
              <dd class="col-sm-8">
                {{ item.category_portfolio }}
              </dd>
              <dt class="col-sm-4">Tipe</dt>
              <dd class="col-sm-8">
                {{ item.type_portfolio }}
              </dd>
              <dt class="col-sm-4">Periode</dt>
              <dd class="col-sm-8">
                {{ item.s_period_portfolio | date:'MMMM yyyy' }} - {{ item.f_period_portfolio | date:'MMMM yyyy' }}
              </dd>
              <dt class="col-sm-12">Tags & Teknologi</dt>
              <dd class="col-sm-12">
                @if ((item.tags_portfolio?.length ?? 0) > 0 || (item.tech_portfolio?.length ?? 0) > 0) {
                  @for (tag of item.tags_portfolio ?? []; track tag) {
                    <span class="badge text-bg-info me-1 mb-1">{{ tag }}</span>
                  }
                  @for (tech of item.tech_portfolio ?? []; track tech) {
                    <span class="badge text-bg-secondary me-1 mb-1">{{ tech }}</span>
                  }
                } @else {
                  <p class="card-text"><small class="text-muted">Tidak ada tag atau teknologi.</small></p>
                }
              </dd>
            </dl>
          </div>
          @if (item.url_portfolio || item.repository_portfolio) {
            <div class="card-footer bg-transparent border-top-0">
              @if (item.overview_case_study || item.goal_case_study || item.problem_case_study) {
                <a [routerLink]="['/portfolio', item.id_portfolio, 'case-study']" class="btn btn-success d-flex align-items-center justify-content-center mb-2">
                  <svg class="bi me-2" width="16" height="16"><use xlink:href="#book-half"></use></svg>
                  Lihat Studi Kasus
                </a>
              }
              <div class="d-grid gap-2">
                @if (item.url_portfolio) {
                  <a [href]="item.url_portfolio" target="_blank" rel="noopener noreferrer" class="btn btn-primary d-flex align-items-center justify-content-center">
                    <svg class="bi me-2" width="16" height="16"><use xlink:href="#box-arrow-up-right"></use></svg>
                    Kunjungi Project
                  </a>
                }
                @if (item.repository_portfolio) {
                  <div class="btn-group w-100" role="group" aria-label="Repository Actions">
                    <a [href]="item.repository_portfolio" target="_blank" rel="noopener noreferrer" class="btn btn-outline-secondary d-flex align-items-center justify-content-center w-75">
                      @switch (item.rep_type_portfolio) {
                        @case ('GitHub') {
                          <svg class="bi me-2" width="16" height="16"><use xlink:href="#github"></use></svg>
                        }
                        @case ('GitLab') {
                          <svg class="bi me-2" width="16" height="16"><use xlink:href="#gitlab"></use></svg>
                        }
                        @case ('Bitbucket') {
                          <svg class="bi me-2" width="16" height="16"><use xlink:href="#bitbucket"></use></svg>
                        }
                        @case ('Document') {
                          <svg class="bi me-2" width="16" height="16"><use xlink:href="#file-earmark-text"></use></svg>
                        }
                        @default {
                          <svg class="bi me-2" width="16" height="16"><use xlink:href="#code-square"></use></svg>
                        }
                      }
                      Lihat Repositori
                    </a>
                    <button type="button" class="btn btn-outline-secondary d-flex align-items-center justify-content-center" (click)="copyToClipboard(item.repository_portfolio)" [title]="copiedUrl() === item.repository_portfolio ? 'Copied!' : 'Copy repository URL'">
                      @if (copiedUrl() === item.repository_portfolio) {
                        <svg class="bi" width="16" height="16"><use xlink:href="#clipboard-check"></use></svg>
                      } @else {
                        <svg class="bi" width="16" height="16"><use xlink:href="#clipboard"></use></svg>
                      }
                    </button>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </div>
    </aside>
  </div>

  <!-- Carousel Modal -->
  <app-carousel-modal
    [id]="'portfolioCarouselModal'"
    [images]="item.gallery_portfolio ?? []"
    [title]="item.title_portfolio"
  />

  <!-- Related Projects Section -->
  <div class="mt-5">
    <h2 class="pb-2 border-bottom">Proyek Terkait</h2>
    @if (relatedProjects().length > 0) {
      <app-card [cardPerRow]="3">
        @for (relatedItem of relatedProjects(); track relatedItem.id_portfolio) {
          <app-portfolio-card [item]="relatedItem" />
        }
      </app-card>
    } @else {
      <p class="text-center col-12">Tidak ada proyek terkait.</p>
    }
  </div>
} @else {
  <div class="container">
    <div class="mb-4">
      <a routerLink="/portfolio" class="btn btn-outline-secondary d-inline-flex align-items-center">
        <svg class="bi me-2" width="16" height="16" aria-hidden="true"><use xlink:href="#arrow-left"></use></svg>
        Back to Portfolio
      </a>
    </div>
  <p class="text-center">Proyek tidak ditemukan.</p>
  </div>
}
